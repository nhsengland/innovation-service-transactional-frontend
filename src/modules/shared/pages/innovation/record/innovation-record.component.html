<theme-content-wrapper [status]="pageStatus">

  <div *ngIf="!innovation.owner.isActive" class="nhsuk-warning-callout nhsuk-u-margin-top-0">
    <div class="nhsuk-heading-m nhsuk-warning-callout__label">
      <span role="text"> <span class="nhsuk-u-visually-hidden">Important: </span> User Locked </span>
    </div>
    <p> Please note that the innovator {{ innovation.owner.name }} is currently locked. </p>
  </div>

  <div class="nhsuk-grid-row">

    <ng-container *ngIf="stores.authentication.isInnovatorType()">
      <ng-container *ngIf="sections.submitted > 0; else firstTimeBanner">

        <div class="nhsuk-grid-column-full">
          <p *ngIf="isInnovationInCreatedStatus(); else innovationSharedText">
            Please complete all sections by providing as much information
            as possible about your innovation. Share your record for a needs
            assessment review - a member of the team will contact you within a
            week to understand how we can best support your current needs.
          </p>
          <ng-template #innovationSharedText>
            <p>You can continue to update your Innovation Record throughout the development of your innovation with support from the NHS Innovation Service.</p>
          </ng-template>

        </div>
      </ng-container>
    </ng-container>

    <div class="nhsuk-grid-column-full">

      <ul class="progressbar progressbar-justified nhsuk-u-padding-bottom-2">
        <li *ngFor="let item of sections.progressBar" class="progressbar-item" [ngClass]="item.substring(2)"></li>
      </ul>

      <p class="d-flex nhsuk-u-margin-0">
        <theme-svg-icon type="success"></theme-svg-icon>
        <span class="nhsuk-u-margin-right-2"></span> {{ sections.submitted }} sections submitted
      </p>
      <p class="d-flex nhsuk-u-margin-0">
        <theme-svg-icon type="edit"></theme-svg-icon>
        <span class="nhsuk-u-margin-right-2"></span> {{ sections.draft }} section in draft
      </p>
      <p class="d-flex">
        <theme-svg-icon type="error"></theme-svg-icon>
        <span class="nhsuk-u-margin-right-2"></span> {{ sections.notStarted }} sections not started
      </p>

      <ng-container *ngIf="stores.authentication.isInnovatorType()">

        <ng-container *ngIf="isInnovationInCreatedStatus()">
          <button class="nhsuk-button nhsuk-u-margin-bottom-2" [disabled]="!allSectionsSubmitted()" (click)="onSubmitInnovation()">Share record for needs assessment</button>
          <p class="nhsuk-body-s">
            Please note: you will not be able to share your record for a needs assessment review
            until you have completed all sections below. You can continue to update your record once it is submitted for
            review.
          </p>
        </ng-container>

        <ng-container *ngIf="innovationStatus === 'PAUSED'" class="nhsuk-u-margin-bottom-4">
          <button class="nhsuk-button" [disabled]="!allSectionsSubmitted()" routerLink="/innovator/innovations/{{ innovationId }}/how-to-proceed/needs-reassessment-send">Share record for needs reassessment</button>
        </ng-container>

        <h4>Helpful documents</h4>
        <ul>
          <li>You may want to <a [href]="documentUrl">download all questions (DOCX, 820KB)</a> you will be asked to
            answer in your innovation record</li>
          <li>You can also <a [href]="pdfDocumentUrl">export your current innovation record (pdf)</a></li>
        </ul>

      </ng-container>

      <ng-container *ngIf="innovation.owner.isActive === true">
        
        <ng-container *ngIf="stores.authentication.isAccessorType() && innovationExport">

          <div class="nhsuk-inset-text nhsuk-u-padding-top-2 nhsuk-u-padding-bottom-2">

            <span class="nhsuk-u-visually-hidden">Information: </span>
            <p class="nhsuk-u-font-size-22 text-decoration-none nhsuk-u-font-weight-bold nhsuk-u-margin-bottom-2">Export innovation record</p>

            <ng-container *ngIf="innovationExport.canUserExport === false">

              <span>
                You need to request permission from the innovator to download their innovation record pdf.
                
                <ng-container *ngIf="innovationExport.pendingRequestsCount === 0">
                  <a routerLink="/accessor/innovations/{{ innovationId }}/export/request" class="nhsuk-link--no-visited-state">Request permission</a>
                  or 
                </ng-container>
                
                <a routerLink="/{{ stores.authentication.userUrlBasePath() }}/innovations/{{ innovationId }}/export/list" class="nhsuk-link--no-visited-state">
                  {{ innovationExport.pendingRequestsCount === 0 ? 'v' : 'V'}}iew requests.
                </a>

              </span>

            </ng-container>

            <ng-container *ngIf="innovationExport.canUserExport === true">

              The innovator approved your organisation unit request.
              <a routerLink="/{{ stores.authentication.userUrlBasePath() }}/innovations/{{ innovationId }}/export/list" class="nhsuk-link--no-visited-state">
                View requests.
              </a>
              <a [href]="pdfDocumentUrl" class="d-inline-block nhsuk-link--no-visited-state">Export innovation record (PDF).</a>

            </ng-container>

          </div>

        </ng-container>

        <ng-container *ngIf="stores.authentication.isInnovatorType() && innovationExport">

          <div class="nhsuk-inset-text nhsuk-u-padding-top-2 nhsuk-u-padding-bottom-2">
            
            <span class="nhsuk-u-visually-hidden">Information: </span>
            <a routerLink="/innovator/innovations/{{ innovationId }}/export/list" class="nhsuk-link--no-visited-state nhsuk-u-font-size-22 text-decoration-none nhsuk-u-font-weight-bold">Innovation record export requests</a>
              
            <ng-container *ngIf="innovationExport.pendingRequestsCount === 0">
              <p class="nhsuk-body-s">No new requests.</p>
            </ng-container>

            <ng-container *ngIf="innovationExport.pendingRequestsCount > 0">
              <p class="nhsuk-body-s">You have {{ innovationExport.pendingRequestsCount }} pending requests.</p>
            </ng-container>

          </div>

        </ng-container>

      </ng-container>

      <h2 class="nhsuk-heading-l">All sections</h2>
      <p *ngIf="stores.authentication.isInnovatorType()">
        Please complete all sections, providing as much information as possible. As you are developing your innovation,
        we do not expect the information to be finalised at this stage, and you can return to update your Innovation
        record once shared for review.
      <p>

      <ol class="app-task-list">
        <li *ngFor="let sectionGroup of innovationSections; let i = index">

          <h2 class="app-task-list__section">
            <span class="app-task-list__section-number">{{ i + 1 }}. </span> {{ sectionGroup.title }}
          </h2>

          <ol class="app-task-list__items">
            <li *ngFor="let section of sectionGroup.sections; let j = index" class="app-task-list__item">

              <ng-container *ngIf="section.status !== 'UNKNOWN'">
                <span class="app-task-list__task-icon">
                  <ng-container *ngTemplateOutlet="icon; context: { status: section.status }"></ng-container>
                </span>
              </ng-container>

              <span class="app-task-list__task-name"> {{ (i + 1) + '.' + (j + 1) }}
                <a routerLink="{{ baseUrl }}/{{section.id}}"><span class="nhsuk-u-visually-hidden"> Go to </span>
                  {{ section.title }}
                  <span class="nhsuk-u-visually-hidden" *ngIf="section.status === 'NOT_STARTED'">Section not
                    started</span>
                  <span class="nhsuk-u-visually-hidden" *ngIf="section.status === 'DRAFT'">Section in draft</span>
                  <span class="nhsuk-u-visually-hidden" *ngIf="section.status === 'SUBMITTED'">Section submitted</span>
                </a>
              </span>

              <ng-container [ngSwitch]="stores.authentication.userUrlBasePath()">
                <ng-container *ngSwitchCase="'innovator'">
                  <span *ngIf="section.openActionsCount >= 1" class="float-r">
                    <theme-tag
                      routerLink="{{ baseUrl }}/{{section.id}}/actions"
                      class="cursor-pointer"
                      type="{{ 'shared.catalog.innovation.action_status.REQUESTED.cssColorClass' | translate }}"
                      label="{{ section.openActionsCount + ' ' + ('dictionary.action' | pluralTranslate: section.openActionsCount | translate) + ' ' + ('shared.catalog.innovation.action_status.REQUESTED.name' | translate | lowercase) }}">
                    </theme-tag>
                  </span>
                </ng-container>
                <ng-container *ngSwitchCase="'accessor'">
                  <span *ngIf="section.openActionsCount >= 1" class="float-r">
                    <theme-tag
                      routerLink="{{ baseUrl }}/{{section.id}}/actions"
                      class="cursor-pointer"
                      type="{{ 'shared.catalog.innovation.action_status.IN_REVIEW.cssColorClass' | translate }}"
                      label="{{ section.openActionsCount + ' ' + ('dictionary.action' | pluralTranslate: section.openActionsCount | translate) + ' ' + ('shared.catalog.innovation.action_status.IN_REVIEW.name' | translate | lowercase) }}">
                    </theme-tag>
                  </span>
                </ng-container>
              </ng-container>

            </li>
          </ol>

        </li>
      </ol>

    </div>
  </div>

</theme-content-wrapper>


<ng-template #icon let-status="status">
  <theme-svg-icon *ngIf="status === 'NOT_STARTED'" type="error"></theme-svg-icon>
  <theme-svg-icon *ngIf="status === 'DRAFT'" type="edit"></theme-svg-icon>
  <theme-svg-icon *ngIf="status === 'SUBMITTED'" type="success"></theme-svg-icon>
</ng-template>


<ng-template #firstTimeBanner>
  <div class="nhsuk-grid-column-full">

    <div class="nhsuk-card nhsuk-card--care nhsuk-card--care--non-urgent nhsuk-u-margin-top-0">

      <div class="nhsuk-card--care__heading-container">
        <h2 class="nhsuk-card--care__heading">
          <span role="text"><span class="nhsuk-u-visually-hidden">Information: </span>Welcome to your Innovation
            Record!</span>
        </h2>
      </div>

      <div class="nhsuk-card__content">
        <p>So that we can match you with the right organisations that can support your next steps on your innovation
          journey, you must:</p>
        <ul>
          <li>Complete all sections by providing as much information about your innovation as possible.</li>
          <li>
            Share your record for a needs assessment review - the Needs Assessment team will contact you within a week
            to understand the type of support you require.
          </li>
        </ul>
        <p>Don't worry! The information you provide doesn't need to be final - you can continue to update your
          Innovation Record through its development with support from the NHS Innovation Service.</p>
      </div>

    </div>

  </div>
</ng-template>
