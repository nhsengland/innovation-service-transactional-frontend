<theme-content-wrapper [status]="pageStatus">

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

      <p *ngIf="isInnovatorType">
        Everyone who has access to your innovation will be able to view and download your documents.
        If you want to stop sharing your innovation with an organisation, update your <a routerLink="../support">data sharing preferences</a>.
      </p>

      <div *ngIf="isInnovatorType" class="nhsuk-inset-text">
        <span class="nhsuk-u-visually-hidden">Information:</span>
        <p>If you want to upload evidence of impact and benefit, go to <a routerLink="../record/sections/EVIDENCE_OF_EFFECTIVENESS">this section of your innovation record</a>.</p>
      </div>

      
      <button *ngIf="!isAdmin" class="nhsuk-button nhsuk-u-margin-bottom-9" routerLink="new">Upload a new document</button>
      
      <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-full">
          <form [formGroup]="form" class="d-flex flex-direction-column">
            <div class="nhsuk-grid-column-one-half nhsuk-u-padding-0">
              <theme-form-input controlName="name" [pageUniqueField]="false" label="Search by document name" placeholder="Search by document name" >
                <ng-container append>
                  <button type="button" (click)="onFormChange()" class="nhsuk-button form-input-appended-button fill-white" style="padding: 4px 12px 0px 10px">
                    <svg class="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" aria-hidden="true" focusable="false" height="24" width="24">
                      <path d="M19.71 18.29l-4.11-4.1a7 7 0 1 0-1.41 1.41l4.1 4.11a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM5 10a5 5 0 1 1 5 5 5 5 0 0 1-5-5z"></path>
                    </svg>
                  </button>
                </ng-container>
              </theme-form-input>
            </div>
            <div>
              <details class="nhsuk-details" *ngIf="showFiltersHideStatus">
                <summary class="nhkus-details__summary" (click)="onShowFiltersClick()">
                  <span class="nhsuk-details__summary-text">Filter documents</span>
                </summary>
                <div class="nhsuk-details__text d-flex flex-direction-column">
                  <div>
                    <div class="nhsuk-grid-column-full nhsuk-u-padding-0">
                      <p class="nhsuk-u-font-weight-bold nhsuk-u-margin-bottom-1">Filter by location</p>
                      <theme-chips-document-location #locationTagsComponent [responseLocations]="responseDocumentsLocations" (locationChipsChange)="setSelectedLocations($event)"></theme-chips-document-location>
                    </div>
                  </div>
                  <div class="nhsuk-grid-column-one-half nhsuk-u-padding-0">
                    <p class="nhsuk-u-font-weight-bold nhsuk-u-margin-bottom-1">Filter by date range</p>
                    <theme-form-input controlName="startDate" label="From" description="For example, 2005 or 21/11/2014" [pageUniqueField]="false"></theme-form-input>
                    <theme-form-input controlName="endDate" label="To" description="For example, 2005 or 21/11/2014" [pageUniqueField]="false"></theme-form-input>
                  </div>
                  <div><a href="javascript:void(0)" (click)="onClearFilters()">Clear all</a></div>
                  <div><button type="button" class="nhsuk-button nhsuk-u-margin-top-3" (click)="onFormChange()"> Apply filters </button></div>
                </div>
              </details>
            </div>
          </form>
        </div>
      </div>
      
      <p class="nhsuk-body-s nhsuk-u-margin-bottom-1">Showing {{ tableList.getVisibleRowsNumber() }} documents of {{ tableList.getTotalRowsNumber() }}</p>

      <hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2" />

      <p *ngIf="tableList.getTotalRowsNumber() === 0" class="nhsuk-u-padding-top-4">There are no documents.</p>

      <div *ngIf="tableList.getTotalRowsNumber() > 0" class="bg-color-white">
        <table class="nhsuk-table-responsive app-sortable-table app-table-inside-card">
          <caption class="nhsuk-u-visually-hidden">
            Documents list
            <span *ngIf="tableList.isSortable()" class="nhsuk-u-visually-hidden">Column headers with buttons are sortable.</span>
          </caption>
          <thead class="nhsuk-table__head">
            <tr>
              <th *ngFor="let item of tableList.getHeaderColumns(); let i = index" scope="col" [ngClass]="item.align" [attr.aria-sort]="item.orderDir">
                <ng-container *ngIf="!item.orderable">{{ item.label }}</ng-container>
                <button [id]="item.key" *ngIf="item.orderable" type="button" (click)="onTableOrder(item.key)">
                  {{ item.label }}
                  <span aria-hidden="true"></span>
                </button>
              </th>
            </tr>
          </thead>
          <tbody class="nhsuk-table__body">
            <tr *ngFor="let item of tableList.getRecords()" class="nhsuk-table__row">
              <td class="nhsuk-table__cell">
                <span class="nhsuk-table-responsive__heading">{{ tableList.getColumnLabel('name') }}</span>
                <div><span class="nhsuk-u-font-weight-bold word-break">{{ item.name }}</span> ({{ item.file.extension | uppercase }}{{ item.file.size ? ', ' + (item.file.size | bytesPrettyPrint)  : ''}})</div>
              </td>
              <td class="nhsuk-table__cell">
                <span class="nhsuk-table-responsive__heading">{{ tableList.getColumnLabel('createdAt') }}</span>
                <div class="nhsuk-body-s nhsuk-u-margin-0">{{ item.createdAt | date: ('app.date_formats.medium_date' | translate) }}</div>
                <div class="nhsuk-hint nhsuk-u-font-size-14 nhsuk-u-margin-0">by {{ item.createdBy.description }}</div>
              </td>
              <td class="nhsuk-table__cell">
                <span class="nhsuk-table-responsive__heading">{{ tableList.getColumnLabel('contextType') }}</span>
                <div class="nhsuk-body-s nhsuk-u-margin-0">{{ item.context.label }}</div>
                <div *ngIf="item.context.description" class="nhsuk-hint nhsuk-u-font-size-14 nhsuk-u-margin-0">{{ item.context.description }}</div>
              </td>
              <td class="nhsuk-table__cell nhsuk-body-s text-align-right">
                <span class="nhsuk-table-responsive__heading">{{ tableList.getColumnLabel('actions') }}</span>
                <div class="nhsuk-u-margin-0"><a href="{{ item.file.url }}" class="nhsuk-u-font-size-14" attr.aria-label="Download {{ item.name }} file">Download</a></div>
                <div class="nhsuk-u-margin-0"><a routerLink="{{ item.id }}" class="nhsuk-u-font-size-14" attr.aria-label="View {{ item.name }} details">More details</a></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="nhsuk-u-padding-bottom-4">
        <theme-pagination [currentPage]="tableList.page" [pageSize]="tableList.pageSize" [totalRows]="tableList.getTotalRowsNumber()" (updatePageEvent)="onPageChange($event)"></theme-pagination>
      </div>

    </div>
  </div>

</theme-content-wrapper>
