<theme-content-wrapper [status]="pageStatus">

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

      <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-full">

          <ng-container *ngIf="assessment?.reassessment">
            <h2 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">Reassessment details</h2>
            <dl class="nhsuk-summary-list">
              <div *ngFor="let item of innovationReassessment" class="nhsuk-summary-list__row">
                <dt class="nhsuk-summary-list__key nhsuk-u-font-weight-normal">{{ item.label }}</dt>
                <dd class="nhsuk-summary-list__value text-pre-wrap">{{ item.value }}</dd>
              </div>
            </dl>
          </ng-container>

          <div>
            <ng-container *ngIf="assessmentHasBeenSubmitted && shouldShowUpdatedAt">
              <p class="nhsuk-body-s font-color-secondary nhsuk-u-margin-bottom-0">{{ assessment?.updatedAt | date: ('app.date_formats.long_date' | translate) }}</p>
              <p class="nhsuk-body-s nhsuk-u-font-weight-bold nhsuk-u-margin-bottom-0">{{ assessment?.updatedBy?.name }}</p>
              <p class="nhsuk-body-s nhsuk-u-margin-bottom-5">Needs assessment team</p>
            </ng-container>

            <p class="nhsuk-body-s font-color-secondary nhsuk-u-margin-bottom-0">{{ assessment?.finishedAt | date: ('app.date_formats.long_date' | translate) }}</p>
            <p class="nhsuk-body-s nhsuk-u-font-weight-bold nhsuk-u-margin-bottom-0">{{ assessment?.assignTo?.name }}</p>
            <p class="nhsuk-body-s nhsuk-u-margin-bottom-5">Needs assessment team</p>

          </div>

          <h2 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">The innovation</h2>
          <p class="text-pre-wrap">{{ assessment?.description }}</p>

          <dl class="nhsuk-summary-list">

            <!-- Maturity level item  -->
            <div class="nhsuk-summary-list__row">
              <dt class="nhsuk-summary-list__key nhsuk-u-font-weight-normal">{{ innovationMaturityLevel.label }}</dt>
              <dd class="nhsuk-summary-list__key width-auto">{{ innovationMaturityLevel.value }}</dd>
              <dd class="nhsuk-summary-list__value text-pre-wrap">
                <ul class="progressbar nhsuk-u-padding-top-2 nhsuk-u-margin-bottom-0">
                  <li class="progressbar-item{{ innovationMaturityLevel.levelIndex >= 1 ? ' active' : ''}}" style="width: 10%"></li>
                  <li class="progressbar-item{{ innovationMaturityLevel.levelIndex >= 2 ? ' active' : ''}}" style="width: 10%"></li>
                  <li class="progressbar-item{{ innovationMaturityLevel.levelIndex === 3 ? ' active' : ''}}" style="width: 10%"></li>
                </ul>
                <p class="nhsuk-body-s font-color-secondary">{{ innovationMaturityLevel.description }}</p>
                <p *ngIf="innovationMaturityLevel.comment" class="nhsuk-u-margin-0">{{ innovationMaturityLevel.comment }}</p>
              </dd>
            </div>

            <div *ngFor="let item of innovationSummary" class="nhsuk-summary-list__row">
              <dt class="nhsuk-summary-list__key nhsuk-u-font-weight-normal">{{ item.label }}</dt>
              <dd class="nhsuk-summary-list__key width-auto">{{ item.value }}</dd>
              <dd class="nhsuk-summary-list__value text-pre-wrap">{{ item.comment }}</dd>
            </div>

          </dl>

          <h2 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">The innovator</h2>
          <dl class="nhsuk-summary-list">
            <div *ngFor="let item of innovatorSummary" class="nhsuk-summary-list__row">
              <dt class="nhsuk-summary-list__key nhsuk-u-font-weight-normal">{{ item.label }}</dt>
              <dd class="nhsuk-summary-list__key width-auto">{{ item.value }}</dd>
              <dd class="nhsuk-summary-list__value text-pre-wrap">{{ item.comment }}</dd>
            </div>
          </dl>

          <h2 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">Support need summary</h2>
          <p class="text-pre-wrap">{{ assessment?.summary }}</p>

          <h2 class="nhsuk-heading-l nhsuk-u-margin-bottom-3">Suggested organisations</h2>
          <p *ngIf="(assessment?.suggestedOrganisations || []).length === 0" class="text-pre-wrap">No suggested organisations</p>
          <div *ngFor="let organisation of assessment?.suggestedOrganisations">
            <p class="nhsuk-u-margin-bottom-1"> {{ organisation.name }} </p>
            <div *ngFor="let unit of organisation?.units">
              <ul *ngIf="organisation.name !== unit.name" class="nhsuk-list nhsuk-u-margin-left-3 nhsuk-u-margin-bottom-0 border-left-inset-neutral">
                <li class="d-flex nhsuk-u-margin-0 nhsuk-u-padding-left-3">
                  <span class="app-task-list__task-name"> {{ unit.name }} </span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>




      <div *ngIf="logHistory.length > 0" class="nhsuk-grid-row nhsuk-u-margin-top-5">
        <div class="nhsuk-grid-column-full">

          <div class="full-width-section bg-color-white">

            <div class="nhsuk-grid-row nhsuk-u-padding-top-5">
              <div class="nhsuk-grid-column-one-quarter"> &nbsp; </div>
              <div class="nhsuk-grid-column-three-quarters">
                <h2 class="nhsuk-heading-l">Support history</h2>
              </div>
            </div>
            <hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-u-margin-bottom-3" />

            <div *ngFor="let item of logHistory" class="nhsuk-grid-row">

              <div class="nhsuk-grid-column-one-quarter">
                <p class="nhsuk-heading-xs nhsuk-u-margin-bottom-0"> {{ item.createdAt | date: ('app.date_formats.long_date' | translate) }} </p>
                <p class="nhsuk-hint nhsuk-u-font-weight-bold nhsuk-u-margin-bottom-0"> {{ item.createdBy }} </p>
                <p class="nhsuk-hint"> {{ item.organisationUnit.name }} </p>
              </div>

              <div class="nhsuk-grid-column-three-quarters">
                <p class="nhsuk-u-font-weight-bold nhsuk-u-margin-0"> {{ item.logTitle }} </p>
                <ng-container [ngSwitch]="item.type">
                  <div *ngSwitchCase="supportLogType.ACCESSOR_SUGGESTION">
                    <p *ngFor="let organisationUnit of item.suggestedOrganisationUnitsNames" class="nhsuk-u-margin-bottom-0"> {{ organisationUnit }} </p>
                  </div>
                  <div *ngSwitchCase="supportLogType.STATUS_UPDATE">
                    <strong class="nhsuk-tag" [ngClass]="innovationSupportStatus[item.innovationSupportStatus].cssClass">{{ innovationSupportStatus[item.innovationSupportStatus].label }}</strong>
                  </div>
                </ng-container>
                <p class="nhsuk-u-font-weight-bold nhsuk-u-margin-0 nhsuk-u-padding-top-4">Comment</p>
                <p> {{ item.description }} </p>
              </div>

              <div class="nhsuk-grid-column-full">
                <hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-u-margin-bottom-3" />
              </div>

            </div>

          </div>

        </div>
      </div>
    </div>
  </div>

</theme-content-wrapper>
