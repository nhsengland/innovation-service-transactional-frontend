<theme-alert [type]="alert.type" [title]="alert.title" [setFocus]="alert.setFocus">
    <p> {{ alert.message }} </p>
</theme-alert>


<theme-spinner *ngIf="pageStatus === 'LOADING'" cssClass="nhsuk-u-margin-9"></theme-spinner>


<div *ngIf="pageStatus === 'READY'" aria-live="polite">
  <div *ngIf="pageStep === 'RULES_LIST'">
    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-two-thirds">
        <table class="nhsuk-table">
          <caption>Condition must be valid to change organisation unit assigned to {{ titleHint }}</caption>
          <thead class="nhsuk-table__head nhsuk-u-visually-hidden">
            <tr class="nhsuk-table__row">
              <th class="nhsuk-table__header" scope="col"> Condition </th>
              <th class="nhsuk-table__header" scope="col"> Is valid </th>
            </tr>
          </thead>
          <tbody class="nhsuk-table__body">
            <tr *ngFor="let item of rulesList" class="nhsuk-table__row">
              <td class="nhsuk-table__cell">
                {{ 'shared.catalog.user.' + item.key + '.label' | translate: user }}
                <!-- <div *ngIf="!item.valid && translationExists('shared.catalog.user.' + item.key + '.description')" class="nhsuk-hint nhsuk-u-margin-0">
                  {{ (item.meta?.unit || item.meta?.organisation) ? ('shared.catalog.user.' + item.key + '.description' | translate: item?.meta) : 'shared.catalog.user.' + item.key + '.description' | pluralTranslate: item?.meta?.supports?.innovations?.length | translate: item?.meta }}
                </div> -->
              </td>
              <td class="nhsuk-table__cell text-align-right">
                <strong class="nhsuk-tag" [ngClass]="{'nhsuk-tag--green': item.valid, 'nhsuk-tag--red': !item.valid}">{{ item.valid ? 'Valid' : 'Invalid' }}</strong>
              </td>
            </tr>
          </tbody>
        </table>
        <button class="nhsuk-button" (click)="pageStep = 'UNIT_LIST'" [disabled]="isRulesValid"> Continue </button>
      </div>
    </div>
  </div>
  
  <ng-container *ngIf="wizard.isQuestionStep() && pageStep === 'UNIT_LIST'">
    <div class="nhsuk-back-link app-u-hide-mobile app-side-nav__back nhsuk-u-margin-bottom-4">
      <a href="javascript:void(0)"  class="nhsuk-back-link__link" (click)="onSubmitStep('previous')">
        <theme-svg-icon type="back"></theme-svg-icon>
        Go back
      </a>
    </div>
    <theme-form-engine #stepForm formId="ftsForm" [parameters]="wizard.currentStepParameters()" [values]="wizard.getAnswers()"></theme-form-engine>
    <button type="submit" form="ftsForm" class="nhsuk-button" (click)="onSubmitStep('next')" [disabled]="stepForm.isFormPending()"> {{ stepForm.isFormPending() ? 'Verifying...' : 'Continue' }} </button>
  </ng-container>

  <ng-container *ngIf="wizard.isSummaryStep()">
    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-three-quarters">

        <theme-alert [type]="alert.type" [title]="alert.title" [setFocus]="alert.setFocus">
          <p> {{ alert.message }} </p>
        </theme-alert>

        <h1 class="nhsuk-heading-l"> Change organisation unit summary </h1>

        <dl class="nhsuk-summary-list">
          <div class="nhsuk-summary-list__row">
            <dt class="nhsuk-summary-list__key">Previous Organisation Unit</dt>
            <dt class="nhsuk-summary-list__value text-pre-wrap">{{ (oldOrganisationUnits[0].name || '') }}</dt>
            <dd class="nhsuk-summary-list__actions"></dd>
          </div>
          <div *ngFor="let item of wizard.getSummary(); let i = index;" class="nhsuk-summary-list__row">
            <dt class="nhsuk-summary-list__key">{{ item.label }}</dt>
            <dd class="nhsuk-summary-list__value text-pre-wrap">{{ item.value }}</dd>
            <dd class="nhsuk-summary-list__actions">
              <a href="javascript:;" (click)="wizard.gotoStep(item.editStepNumber || 1)"> Change <span class="nhsuk-u-visually-hidden"> {{ item.label | lowercase }} </span></a>
            </dd>
          </div>
        </dl>
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <ng-container *ngIf="pageStep === 'CODE_REQUEST'">
            <theme-form-input controlName="code" label="Enter the confirmation code" [pageUniqueField]="false"></theme-form-input>
          </ng-container>
          <button type="submit" class="nhsuk-button nhsuk-u-margin-top-3 nhsuk-u-margin-right-3" [disabled]="submitBtnClicked || form.pending || form.invalid"> {{(wizard.isSummaryStep()) ? 'Submit' : 'Continue'}} </button>
        </form>
      </div>
    </div>
  </ng-container>

</div>
