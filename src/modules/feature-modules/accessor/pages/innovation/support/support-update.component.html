<theme-content-wrapper [status]="pageStatus">

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

      <form [formGroup]="form">

        <ng-container *ngIf="stepNumber === 1">

          <div class="nhsuk-form-group">
            <fieldset class="nhsuk-fieldset">

              <legend class="nhsuk-fieldset__legend"> Choose a support status </legend>

              <div class="nhsuk-radios">
                <div *ngFor="let item of supportStatus; let i = index" class="nhsuk-radios__item">
                  <input formControlName="status" id="status{{ i }}" type="radio" name="status" [value]="item.key" class="nhsuk-radios__input" />
                  <label for="status{{ i }}" class="nhsuk-label nhsuk-radios__label nhsuk-u-padding-top-1 nhsuk-u-padding-bottom-2">
                    <strong class="nhsuk-tag" [ngClass]="item.cssClass"> {{ item.label }} </strong>
                  </label>
                  <div class="nhsuk-hint nhsuk-radios__hint"> {{ item.description }} </div>
                </div>
              </div>

            </fieldset>
          </div>

          <button class="nhsuk-button nhsuk-u-margin-top-3 nhsuk-u-margin-right-3" (click)="onSubmitStep()"> Continue </button>

        </ng-container>


        <ng-container *ngIf="stepNumber === 2">

          <div class="nhsuk-heading-m">
            <div>You selected:</div>
            <theme-tag type="{{ 'shared.catalog.innovation.support_status.' + currentStatus + '.cssColorClass' | translate }}" label="{{ 'shared.catalog.innovation.support_status.' + currentStatus + '.name' | translate }}"></theme-tag>
          </div>

          <p class="nhsuk-hint"> {{ supportStatusObj[currentStatus ?? 'UNASSIGNED'].description }} </p>

          <theme-form-checkbox-array arrayName="accessors" label="Assign one or more accessors from {{ userOrganisationUnit?.name }}" [items]="formAccessorsList" [pageUniqueField]="false"></theme-form-checkbox-array>

          <button class="nhsuk-button nhsuk-u-margin-top-3" (click)="onSubmitStep()"> Continue </button>

        </ng-container>

        <ng-container *ngIf="stepNumber === 3">

          <p *ngIf="selectedAccessors.length > 0" class="nhsuk-heading-m nhsuk-u-margin-0"> You assigned </p>
          <ul>
            <li *ngFor="let item of selectedAccessors" class="d-flex align-items-center nhsuk-u-margin-0">
              <theme-svg-icon type="success" class="nhsuk-u-margin-top-2 nhsuk-u-margin-right-1"></theme-svg-icon>
              <div> {{ item.name }} </div>
            </li>
          </ul>

          <theme-form-textarea controlName="message" [label]="getMessageLabel()" [pageUniqueField]="false" lengthLimit="large"></theme-form-textarea>

            <ng-container *ngIf="currentStatus === 'NOT_YET' || currentStatus === 'COMPLETE' || currentStatus=== 'UNSUITABLE'; else submitAnswear">
              <button class="nhsuk-button nhsuk-u-margin-top-3 nhsuk-u-margin-right-3" (click)="onSubmitStep()"> Continue and post message </button>
            </ng-container>

            <ng-template #submitAnswear>
              <button class="nhsuk-button nhsuk-u-margin-top-3 nhsuk-u-margin-right-3" (click)="onSubmit()"> Save and post message </button>
            </ng-template>

        </ng-container>

        <ng-container *ngIf=" stepNumber === 4 ">

          <a href="transactional/accessor/innovations/{{innovationId}}/support/organisations" target="_blank" rel="noopener noreferrer">Review innovation's support status here (open in a new window)</a>

          <theme-form-radio-group controlName="suggestOrganisations" [description]="formfieldAction.description" [items]="formfieldAction.items"></theme-form-radio-group>

          <button class="nhsuk-button nhsuk-u-margin-top-3" (click)="onSubmitStep()"> Continue </button>

        </ng-container>

        <ng-container *ngIf="currentSuggestOrganisations === 'YES' && stepNumber === 5 ">

          <div class="nhsuk-grid-row">
            <div class="nhsuk-grid-column-full">
              <p class="nhsuk-body-l">Review referral guidance and select the organisations you think would be right to offer support. These organisations will be notified.</p>
              <ul class="nhsuk-list">
                <li><a href="/about-the-service/who-we-are" target="_blank" rel="noopener noreferrer">Support Offer Guide (opens in a new window)</a></li>
                <li *ngIf="isQualifyingAccessorRole === true">
                  <a routerLink="/accessor/organisations/referral-criteria" aria-label="View organisation referral criteria" target="_blank">
                    Organisation referral criteria (opens in a new window)
                  </a>
                </li>
              </ul>
              <theme-form-grouped-checkbox-array arrayName="organisationUnits" label="Select the organisations you think would be right to offer support. These organisations will be notified." [groupedItems]="groupedItems"
                [pageUniqueField]="false"></theme-form-grouped-checkbox-array>
              <button class="nhsuk-button nhsuk-u-margin-top-3" (click)="onSubmitStep()"> Continue </button>

            </div>
          </div>

        </ng-container>

        <ng-container *ngIf="stepNumber === 6">
          <div class="nhsuk-grid-row">
            <div class="nhsuk-grid-column-two-thirds">

              <p class="nhsuk-u-font-weight-bold nhsuk-u-margin-0"> You have selected: </p>
              <ul class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-bottom-5">
                <li *ngFor="let organisation of chosenUnits.list">
                  {{ organisation.organisation }}
                  <ul *ngIf="organisation.units.length > 0" class="nhsuk-list nhsuk-list--bullet nhsuk-u-margin-0">
                    <li *ngFor="let unit of organisation.units" class="nhsuk-u-margin-0"> {{ unit }} </li>
                  </ul>
                </li>
              </ul>

              <theme-form-textarea controlName="comment" label="Describe briefly why you selected these organisations" [pageUniqueField]="false" lengthLimit="large"></theme-form-textarea>
              <theme-form-checkbox controlName="confirm" label="I confirm that I understand the support offers of the selected organisations" size="small"></theme-form-checkbox>

              <button [disabled]="!submitButton.isActive" (click)="onSubmit()" class="nhsuk-button nhsuk-u-margin-top-3"> Continue </button>

            </div>
          </div>
        </ng-container>

        <div>
          <a routerLink="/accessor/innovations/{{ innovationId }}/support">Cancel</a>
        </div>

      </form>

    </div>
  </div>

</theme-content-wrapper>
